<script>
//var socket = io.connect('http://detect.herokuapp.com');
var socket = io.connect('http://localhost:3000');

socket.on('connect',function(data){
		if(!connected){
			connected = 1;
			socket.emit('joinRoom',{
				room: '{{this.room}}',
				nickname: '{{this.nickname}}'
			});

			setName("#myNickname",'{{this.nickname}}');
		}
		socket.on('opponentReady',function(data){
			console.log('setting opponent nick: ' + data.nickname);
			setName("#opponentNickname",data.nickname);
			setOpponentReady();
		});
		

		socket.on('opponentLocation',function(data){
			setOpponent(data.bodyX,data.bodyY,data.frontX,data.frontY);
			addProjectiles(data.ids, data.projectiles);
		});

		socket.on('opponentHit',function(data){
			//console.log('the oppoent got hit by : ' + data.projectileId);
			removeProjectile(data.projectileId);
			incrementScore("#myScore");
		});
});

function ready(){
	$("#start").toggle();
	socket.emit('ready',{
		room: '{{this.room}}'
	});
	startGame();
}

function sendHit(id){
	socket.emit('hit',{
		room: '{{this.room}}',
		projectileId: id
	});
}

function sendPosition(){
	var tempProj = [];
	var tempId = [];
	var index;
	var proj = getProjectiles();
	var i = getIds();
	for(index = 0;index < proj.length;index++){
		tempProj.push(proj[index]);
	}
	for(index = 0;index < i.length;index++){
		tempId.push(i[index] * -1);
	}
	var reflectBody = reflectPoint(getBodyX(),getBodyY());
	var reflectFront = reflectPoint(getFrontX(),getFrontY());
	console.log('sending my location: (' + reflectBody.x + ',' + reflectBody.y + ')')
	socket.emit('myLocation',{
		bodyX: reflectBody.x,
		bodyY: reflectBody.y,
		frontX: reflectFront.x,
		frontY: reflectFront.y,
		projectiles: tempProj,
		ids: tempId,
		room: '{{this.room}}'
	});
}
</script>

<div class="row-fluid">
  <div class="span4 offset4 text-center">
  	<h1>Detect</h1>
    <button id="start" class="btn btn-primary" onClick="ready();">Start</button>
	<br><br>

	<div id="wrapperPlayers">
		<div class="player">
			<div id="myNickname" class="playerName">
				Player One
			</div>
			<div id="myScore" class="playerScore">
				0
			</div>
		</div>
		<div class="player">
			<div id="opponentNickname" class="playerName">
				Player Two
			</div>
			<div id="opponentScore" class="playerScore">
				0
			</div>
		</div>
	</div>
	<br>
	<div id="game"></div>
  </div>
</div>

